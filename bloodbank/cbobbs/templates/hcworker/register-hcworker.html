{% extends "hcworker/base.html" %} 
{% block title %} Health Center {% endblock %}
{% block header %} Health Center {% endblock %}

{% block content %} 
<h2>Blood Inventory Overview</h2>

<div class="section">
    <h3>üìä Blood Type Distribution</h3>
    <canvas id="bloodTypeChart" width="400" height="400"></canvas>
</div>

<div class="section">
    <h3>üö® Low Supply Alerts</h3>
    {% if low_supply_notes %}
        <ul>
            {% for btype in low_supply_notes %}
                <li><strong>{{ btype }}</strong> is running low</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>All blood types sufficiently stocked.</p>
    {% endif %}
</div>

<div class="section">
    <h3>üè• By Blood Bank</h3>
    <div class="card-container">
        {% for bank, blood_data in bloodbank_stats.items %}
            <div class="card">
                <h4>{{ bank }}</h4>
                {% for blood_type, count in blood_data.items %}
                    <div class="stat">{{ blood_type }}: {{ count }}</div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>

<div class="section">
    <h3>üß™ By Health Center</h3>
    <div class="card-container">
        {% for center, blood_data in healthcenter_stats.items %}
            <div class="card">
                <h4>{{ center }}</h4>
                {% for blood_type, count in blood_data.items %}
                    <div class="stat">{{ blood_type }}: {{ count }}</div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('bloodTypeChart').getContext('2d');
    const data = {
        labels: {{ overall_counts.keys|safe }},
        datasets: [{
            data: {{ overall_counts.values|safe }},
            backgroundColor: [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                '#9966FF', '#FF9F40', '#E7E9ED', '#8DD1E1'
            ],
            hoverOffset: 4
        }]
    };

    new Chart(ctx, {
        type: 'pie',
        data: data,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
</script>
{% endblock %}
